<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics Dashboard - SMS Shield</title>
  <link rel="stylesheet" href="enhanced-design.css">
  <link rel="stylesheet" href="cross-platform-responsive.css">
  <link rel="stylesheet" href="all.min.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    .auth-link {
      background: var(--gradient-primary);
      padding: 0.5rem 1rem;
      border-radius: var(--radius-lg);
      color: white !important;
      font-weight: 600;
      transition: all var(--transition-normal);
    }
    
    .auth-link:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
  </style>
  
  <style>
    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }

    .dashboard-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--space-lg);
      margin-bottom: var(--space-2xl);
    }

    .stat-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      box-shadow: var(--glass-shadow);
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.6s ease-in-out;
    }

    .stat-card:hover::before {
      left: 100%;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-2xl);
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      margin-bottom: var(--space-md);
      background: var(--gradient-primary);
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: var(--space-xs);
    }

    .stat-label {
      color: rgba(255, 255, 255, 0.8);
      font-weight: 500;
      margin-bottom: var(--space-sm);
    }

    .stat-trend {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      font-size: 0.9rem;
      font-weight: 600;
    }

    .trend-up {
      color: var(--success-color);
    }

    .trend-down {
      color: var(--danger-color);
    }

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: var(--space-xl);
      margin-bottom: var(--space-2xl);
    }

    .chart-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      box-shadow: var(--glass-shadow);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-lg);
    }

    .chart-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: white;
    }

    .chart-controls {
      display: flex;
      gap: var(--space-sm);
    }

    .chart-control-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 0.4rem 0.8rem;
      border-radius: var(--radius-md);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all var(--transition-normal);
    }

    .chart-control-btn:hover,
    .chart-control-btn.active {
      background: var(--gradient-primary);
      border-color: transparent;
    }

    .recent-activity {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      box-shadow: var(--glass-shadow);
    }

    .activity-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: var(--space-lg);
    }

    .activity-item {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      padding: var(--space-md);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-sm);
      background: rgba(255, 255, 255, 0.05);
      transition: all var(--transition-normal);
    }

    .activity-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .activity-content {
      flex: 1;
    }

    .activity-title {
      color: white;
      font-weight: 600;
      margin-bottom: 0.2rem;
    }

    .activity-details {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
    }

    .activity-time {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.8rem;
      white-space: nowrap;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-md);
      margin-top: var(--space-2xl);
    }

    .action-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--space-lg);
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-normal);
      text-decoration: none;
      color: white;
    }

    .action-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-xl);
      background: rgba(255, 255, 255, 0.15);
    }

    .action-icon {
      font-size: 2rem;
      margin-bottom: var(--space-sm);
    }

    .action-title {
      font-weight: 600;
      margin-bottom: var(--space-xs);
    }

    .action-description {
      font-size: 0.9rem;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <!-- Cache Clear Button -->
  <button class="cache-clear-btn" onclick="clearCacheAndReload()" aria-label="Clear cache" style="position: fixed; top: 20px; right: 80px; z-index: 1000; background: rgba(239, 68, 68, 0.9); color: white; border: none; padding: 10px; border-radius: 50%; cursor: pointer; font-size: 16px; backdrop-filter: blur(10px);">
    üîÑ
  </button>

  <!-- Enhanced Header -->
  <header class="enhanced-header">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo-icon">üõ°Ô∏è</div>
        <a href="index.html" class="logo-text">SMS Shield</a>
      </div>
      
      <!-- User Info Display -->
      <div id="userInfo" style="color: white; font-weight: 600; margin-right: 1rem; display: none;">
        Welcome, User
      </div>
      
      <nav class="enhanced-nav">
        <a href="index.html" class="nav-link">Home</a>
        <a href="detect.html" class="nav-link">Detect</a>
        <a href="dashboard.html" class="nav-link active">Dashboard</a>
        <a href="profile.html" class="nav-link">Profile</a>
        <a href="about.html" class="nav-link">About</a>
        <a href="contact.html" class="nav-link">Contact</a>
        <a href="logout.html" class="nav-link auth-link">Logout</a>
        
        <!-- Notification Bell -->
        <div class="notification-bell-container">
          <button class="nav-link notification-bell" onclick="toggleNotificationPanel()" aria-label="View notifications">
            üîî
            <span class="notification-badge" id="notification-badge" style="display: none;">0</span>
          </button>
          
          <!-- Notification Panel -->
          <div class="notification-panel" id="notification-panel">
            <div class="notification-panel-header">
              <h3>Notifications</h3>
              <button class="clear-notifications-btn" onclick="clearAllNotifications()">Clear All</button>
            </div>
            <div class="notification-list" id="notification-list">
              <div class="no-notifications">No notifications yet</div>
            </div>
          </div>
        </div>
      </nav>

      <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu">
        ‚ò∞
      </button>
    </div>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mobile-menu">
      <div class="mobile-menu-links">
        <a href="index.html" class="nav-link">üè† Home</a>
        <a href="detect.html" class="nav-link">üîç Detect SMS</a>
        <a href="dashboard.html" class="nav-link">üìä Dashboard</a>
        <a href="profile.html" class="nav-link">üë§ Profile</a>
        <a href="about.html" class="nav-link">‚ÑπÔ∏è About</a>
        <a href="contact.html" class="nav-link">üìû Contact</a>
        <a href="logout.html" class="nav-link">üö™ Logout</a>
        <button class="nav-link notification-bell" onclick="toggleNotificationPanel()" aria-label="View notifications">
          üîî
          <span class="notification-badge" style="display: none;">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Dashboard Container -->
  <div class="dashboard-container" style="margin-top: 120px;">
    
    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <h1 style="font-size: 3rem; margin-bottom: 1rem; background: linear-gradient(135deg, #fff, #f0f0f0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
        üìä Security Analytics Dashboard
      </h1>
      <p style="font-size: 1.2rem; opacity: 0.9; max-width: 600px; margin: 0 auto;">
        Real-time insights into your SMS security and threat detection performance
      </p>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card animate-slide-up">
        <div class="stat-icon" style="background: var(--gradient-success);">üìà</div>
        <div class="stat-value">1,247</div>
        <div class="stat-label">Messages Analyzed</div>
        <div class="stat-trend trend-up">
          <i class="fas fa-arrow-up"></i>
          <span>+12% this week</span>
        </div>
      </div>

      <div class="stat-card animate-slide-up" style="animation-delay: 0.1s;">
        <div class="stat-icon" style="background: var(--gradient-danger);">üö®</div>
        <div class="stat-value">23</div>
        <div class="stat-label">Threats Detected</div>
        <div class="stat-trend trend-down">
          <i class="fas fa-arrow-down"></i>
          <span>-8% this week</span>
        </div>
      </div>

      <div class="stat-card animate-slide-up" style="animation-delay: 0.2s;">
        <div class="stat-icon" style="background: var(--gradient-accent);">üéØ</div>
        <div class="stat-value">98.7%</div>
        <div class="stat-label">Detection Accuracy</div>
        <div class="stat-trend trend-up">
          <i class="fas fa-arrow-up"></i>
          <span>+0.3% this week</span>
        </div>
      </div>

      <div class="stat-card animate-slide-up" style="animation-delay: 0.3s;">
        <div class="stat-icon" style="background: var(--gradient-secondary);">‚ö°</div>
        <div class="stat-value">0.3s</div>
        <div class="stat-label">Avg. Analysis Time</div>
        <div class="stat-trend trend-down">
          <i class="fas fa-arrow-down"></i>
          <span>-15% faster</span>
        </div>
      </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
      <!-- Threat Detection Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <h3 class="chart-title">Threat Detection Trends</h3>
          <div class="chart-controls">
            <button class="chart-control-btn active">7D</button>
            <button class="chart-control-btn">30D</button>
            <button class="chart-control-btn">90D</button>
          </div>
        </div>
        <canvas id="threatChart" width="400" height="200"></canvas>
      </div>

      <!-- Message Types Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <h3 class="chart-title">Message Categories</h3>
          <div class="chart-controls">
            <button class="chart-control-btn active">Today</button>
            <button class="chart-control-btn">Week</button>
            <button class="chart-control-btn">Month</button>
          </div>
        </div>
        <canvas id="categoriesChart" width="400" height="200"></canvas>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="recent-activity">
      <div class="activity-header">
        <h3 style="color: white; font-size: 1.5rem; margin: 0;">Recent Activity</h3>
        <a href="#" style="color: var(--accent-color); text-decoration: none; font-weight: 500;">View All</a>
      </div>

      <div class="activity-item">
        <div class="activity-icon" style="background: var(--gradient-danger);">üö®</div>
        <div class="activity-content">
          <div class="activity-title">High-risk SMS detected</div>
          <div class="activity-details">Phishing attempt from unknown sender blocked</div>
        </div>
        <div class="activity-time">2 min ago</div>
      </div>

      <div class="activity-item">
        <div class="activity-icon" style="background: var(--gradient-success);">‚úÖ</div>
        <div class="activity-content">
          <div class="activity-title">Safe message verified</div>
          <div class="activity-details">Legitimate bank notification confirmed</div>
        </div>
        <div class="activity-time">15 min ago</div>
      </div>

      <div class="activity-item">
        <div class="activity-icon" style="background: var(--gradient-accent);">üîÑ</div>
        <div class="activity-content">
          <div class="activity-title">AI model updated</div>
          <div class="activity-details">Detection accuracy improved to 98.7%</div>
        </div>
        <div class="activity-time">1 hour ago</div>
      </div>

      <div class="activity-item">
        <div class="activity-icon" style="background: var(--gradient-secondary);">üìä</div>
        <div class="activity-content">
          <div class="activity-title">Weekly report generated</div>
          <div class="activity-details">Security summary for past 7 days available</div>
        </div>
        <div class="activity-time">2 hours ago</div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <a href="detect.html" class="action-card">
        <div class="action-icon">üîç</div>
        <div class="action-title">Analyze SMS</div>
        <div class="action-description">Check a new message for threats</div>
      </a>

              <a href="detect.html" class="action-card">
                  <div class="action-icon">üîç</div>
                  <div class="action-title">SMS Detection</div>
                  <div class="action-description">Analyze SMS messages for threats</div>
      </a>

      <a href="#" class="action-card">
        <div class="action-icon">üì±</div>
        <div class="action-title">SMS Integration</div>
        <div class="action-description">Connect your messaging app</div>
      </a>

      <a href="#" class="action-card">
        <div class="action-icon">üìà</div>
        <div class="action-title">Reports</div>
        <div class="action-description">View detailed analytics</div>
      </a>
    </div>
  </div>

  <!-- Firebase SDK Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  
  <!-- Scripts -->
  <script src="firebase-fixed.js"></script>
  <script src="auth-state-manager.js"></script>
  <script src="notification-system.js"></script>
  <script src="notification-panel.js"></script>
  <script src="chatbot-ml-model.js"></script>
  <script src="chatbot-system.js"></script>
  <script src="darkMode.js"></script>
  <script src="navigation-fix.js"></script>

  <script>
    // Dashboard functionality with Auth Manager
    document.addEventListener('DOMContentLoaded', function() {
      // Check if user is signed in
      if (!authManager.isSignedIn()) {
        // Redirect to login if not signed in
        window.location.href = 'login.html';
        return;
      }
      
      // Show personalized welcome message
      const userEmail = authManager.getUserEmail();
      setTimeout(() => {
        if (window.showSuccess) {
          showSuccess(`Welcome to your dashboard, ${userEmail}! View your security analytics.`, 'üìä Dashboard');
        }
      }, 1000);
      
      // Add auth state listener
      authManager.addAuthListener((user) => {
        if (!user) {
          // User signed out, redirect to login
          window.location.href = 'login.html';
        }
      });
    });

    // Theme is now handled by darkMode.js
    
    // Initialize charts
    window.addEventListener('DOMContentLoaded', () => {
      initializeCharts();
    });

    // Initialize Chart.js charts
    function initializeCharts() {
      // Threat Detection Trend Chart
      const threatCtx = document.getElementById('threatChart').getContext('2d');
      new Chart(threatCtx, {
        type: 'line',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [{
            label: 'Threats Detected',
            data: [12, 8, 15, 6, 11, 4, 9],
            borderColor: '#ef4444',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4
          }, {
            label: 'Safe Messages',
            data: [145, 167, 134, 178, 156, 189, 142],
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: 'white'
              }
            }
          },
          scales: {
            x: {
              ticks: { color: 'rgba(255, 255, 255, 0.7)' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            y: {
              ticks: { color: 'rgba(255, 255, 255, 0.7)' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
          }
        }
      });

      // Message Categories Doughnut Chart
      const categoriesCtx = document.getElementById('categoriesChart').getContext('2d');
      new Chart(categoriesCtx, {
        type: 'doughnut',
        data: {
          labels: ['Safe Messages', 'Phishing', 'Spam', 'Suspicious'],
          datasets: [{
            data: [78, 12, 7, 3],
            backgroundColor: [
              '#10b981',
              '#ef4444',
              '#f59e0b',
              '#8b5cf6'
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: 'white',
                padding: 20,
                usePointStyle: true
              }
            }
          }
        }
      });
    }

    // Enhanced scroll animations
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, observerOptions);

    // Authentication check and user display
    function checkAuthentication() {
      const currentUser = localStorage.getItem('current_user');
      if (!currentUser) {
        // Redirect to login if not authenticated
        window.location.href = 'login.html';
        return;
      }

      try {
        const user = JSON.parse(currentUser);
        const loginTime = user.loginTime;
        const now = Date.now();
        
        // Check if session is still valid (24 hours)
        if (now - loginTime >= 24 * 60 * 60 * 1000) {
          // Session expired
          localStorage.removeItem('current_user');
          window.location.href = 'login.html';
          return;
        }

        // Display user information
        const userInfo = document.getElementById('userInfo');
        if (userInfo && user.firstName) {
          userInfo.textContent = `Welcome, ${user.firstName} ${user.lastName || ''}`;
          userInfo.style.display = 'block';
        } else if (userInfo && user.email) {
          userInfo.textContent = `Welcome, ${user.email}`;
          userInfo.style.display = 'block';
        }
      } catch (error) {
        localStorage.removeItem('current_user');
        window.location.href = 'login.html';
      }
    }

    // Observe all stat cards for animation
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize cross-platform features
      if (window.crossPlatformManager) {
        console.log('‚úÖ Cross-platform manager initialized');
        console.log('Device info:', window.crossPlatformManager.getDeviceInfo());
      }
      
      // Check authentication first
      checkAuthentication();
      
      const statCards = document.querySelectorAll('.stat-card');
      statCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
        observer.observe(card);
      });
    });

    // Chart control buttons
    document.querySelectorAll('.chart-control-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        // Remove active class from siblings
        this.parentNode.querySelectorAll('.chart-control-btn').forEach(sibling => {
          sibling.classList.remove('active');
        });
        // Add active class to clicked button
        this.classList.add('active');
        
        // Here you would typically update the chart data based on the selected period
        console.log('Chart period changed to:', this.textContent);
      });
    });

    // Simulate real-time updates
    setInterval(() => {
      // Update random stat values slightly to simulate real-time data
      const statValues = document.querySelectorAll('.stat-value');
      statValues.forEach(stat => {
        if (Math.random() < 0.1) { // 10% chance to update each stat
          const currentValue = parseInt(stat.textContent.replace(/[^\d]/g, ''));
          if (!isNaN(currentValue)) {
            const change = Math.floor(Math.random() * 3) - 1; // -1, 0, or 1
            const newValue = Math.max(0, currentValue + change);
            stat.textContent = stat.textContent.replace(/\d+/, newValue);
          }
        }
      });
    }, 5000); // Update every 5 seconds
  </script>
</body>
</html>
