<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMS Detector Test - Error Diagnostics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            min-height: 100vh;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .test-button {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status.success {
            background: rgba(40, 167, 69, 0.3);
            border: 1px solid #28a745;
        }
        
        .status.error {
            background: rgba(220, 53, 69, 0.3);
            border: 1px solid #dc3545;
        }
        
        .status.warning {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid #ffc107;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .error-details {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .fix-suggestion {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîß SMS Detector Error Diagnostics</h1>
    
    <div class="test-section">
        <h2>üì± SMS Detector Initialization Test</h2>
        <button class="test-button" onclick="testSMSDetectorInit()">Test SMS Detector Initialization</button>
        <button class="test-button" onclick="testSMSDetectorAvailability()">Test SMS Detector Availability</button>
        <button class="test-button" onclick="testSMSDetectorMethods()">Test SMS Detector Methods</button>
        <div id="init-status" class="status"></div>
    </div>
    
    <div class="test-section">
        <h2>üîç Error Analysis</h2>
        <button class="test-button" onclick="analyzeErrors()">Analyze Current Errors</button>
        <button class="test-button" onclick="checkDependencies()">Check Dependencies</button>
        <button class="test-button" onclick="testBrowserCompatibility()">Test Browser Compatibility</button>
        <div id="error-status" class="status"></div>
    </div>
    
    <div class="test-section">
        <h2>üìä Detailed Test Results</h2>
        <div id="test-log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>üõ†Ô∏è Error Fixes</h2>
        <div id="error-fixes"></div>
    </div>
    
    <script>
        // Test logging function
        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logEntry.style.color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#fff';
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // Test SMS Detector initialization
        function testSMSDetectorInit() {
            const statusDiv = document.getElementById('init-status');
            try {
                log('Testing SMS Detector initialization...', 'info');
                
                // Check if the class exists
                if (typeof MobileSMSDetector === 'undefined') {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå MobileSMSDetector class not found';
                    log('MobileSMSDetector class is not defined', 'error');
                    return;
                }
                
                // Check if instance exists
                if (!window.mobileSMSDetector) {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå Mobile SMS Detector instance not found';
                    log('Mobile SMS Detector instance is not available', 'error');
                    return;
                }
                
                // Check initialization status
                if (window.mobileSMSDetector.isInitialized) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ SMS Detector initialized successfully';
                    log('SMS Detector is properly initialized', 'success');
                } else {
                    statusDiv.className = 'status warning';
                    statusDiv.textContent = '‚ö†Ô∏è SMS Detector not fully initialized';
                    log('SMS Detector initialization incomplete', 'warning');
                }
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå SMS Detector initialization test failed';
                log(`SMS Detector initialization test error: ${error.message}`, 'error');
            }
        }
        
        // Test SMS Detector availability
        function testSMSDetectorAvailability() {
            const statusDiv = document.getElementById('init-status');
            try {
                log('Testing SMS Detector availability...', 'info');
                
                const checks = {
                    'MobileSMSDetector class': typeof MobileSMSDetector !== 'undefined',
                    'mobileSMSDetector instance': !!window.mobileSMSDetector,
                    'isMobileDevice method': !!window.mobileSMSDetector?.isMobileDevice,
                    'analyzeMobileSMS method': !!window.mobileSMSDetector?.analyzeMobileSMS,
                    'enableRealTimeMode method': !!window.mobileSMSDetector?.enableRealTimeMode
                };
                
                const failedChecks = Object.entries(checks).filter(([name, available]) => !available);
                
                if (failedChecks.length === 0) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ All SMS Detector components available';
                    log('All SMS Detector components are available', 'success');
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = `‚ùå Missing components: ${failedChecks.map(([name]) => name).join(', ')}`;
                    log(`Missing SMS Detector components: ${failedChecks.map(([name]) => name).join(', ')}`, 'error');
                }
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå SMS Detector availability test failed';
                log(`SMS Detector availability test error: ${error.message}`, 'error');
            }
        }
        
        // Test SMS Detector methods
        function testSMSDetectorMethods() {
            const statusDiv = document.getElementById('init-status');
            try {
                log('Testing SMS Detector methods...', 'info');
                
                if (!window.mobileSMSDetector) {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå SMS Detector not available for method testing';
                    log('SMS Detector not available for method testing', 'error');
                    return;
                }
                
                const methods = [
                    'isMobileDevice',
                    'analyzeMobileSMS',
                    'enableRealTimeMode',
                    'checkClipboardForSMS',
                    'showNotification',
                    'showError'
                ];
                
                const availableMethods = methods.filter(method => 
                    typeof window.mobileSMSDetector[method] === 'function'
                );
                
                if (availableMethods.length === methods.length) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ All SMS Detector methods available';
                    log('All SMS Detector methods are available', 'success');
                } else {
                    const missingMethods = methods.filter(method => 
                        typeof window.mobileSMSDetector[method] !== 'function'
                    );
                    statusDiv.className = 'status warning';
                    statusDiv.textContent = `‚ö†Ô∏è Missing methods: ${missingMethods.join(', ')}`;
                    log(`Missing SMS Detector methods: ${missingMethods.join(', ')}`, 'warning');
                }
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå SMS Detector methods test failed';
                log(`SMS Detector methods test error: ${error.message}`, 'error');
            }
        }
        
        // Analyze errors
        function analyzeErrors() {
            const statusDiv = document.getElementById('error-status');
            const fixesDiv = document.getElementById('error-fixes');
            
            try {
                log('Analyzing errors...', 'info');
                
                const errors = [];
                const warnings = [];
                
                // Check for common errors
                if (typeof MobileSMSDetector === 'undefined') {
                    errors.push('MobileSMSDetector class not loaded');
                }
                
                if (!window.mobileSMSDetector) {
                    errors.push('Mobile SMS Detector instance not created');
                }
                
                if (!('Notification' in window)) {
                    warnings.push('Notifications API not supported');
                }
                
                if (!navigator.clipboard) {
                    warnings.push('Clipboard API not supported');
                }
                
                if (!('serviceWorker' in navigator)) {
                    warnings.push('Service Worker not supported');
                }
                
                // Display results
                if (errors.length === 0 && warnings.length === 0) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ No errors detected';
                    log('No errors detected in SMS Detector', 'success');
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = `‚ùå ${errors.length} errors, ${warnings.length} warnings`;
                    log(`Found ${errors.length} errors and ${warnings.length} warnings`, 'error');
                }
                
                // Generate fix suggestions
                let fixHTML = '';
                
                if (errors.length > 0) {
                    fixHTML += '<div class="error-details"><h3>üö® Critical Errors:</h3><ul>';
                    errors.forEach(error => {
                        fixHTML += `<li>${error}</li>`;
                    });
                    fixHTML += '</ul></div>';
                }
                
                if (warnings.length > 0) {
                    fixHTML += '<div class="fix-suggestion"><h3>‚ö†Ô∏è Warnings:</h3><ul>';
                    warnings.forEach(warning => {
                        fixHTML += `<li>${warning}</li>`;
                    });
                    fixHTML += '</ul></div>';
                }
                
                if (fixHTML) {
                    fixesDiv.innerHTML = fixHTML;
                }
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Error analysis failed';
                log(`Error analysis failed: ${error.message}`, 'error');
            }
        }
        
        // Check dependencies
        function checkDependencies() {
            const statusDiv = document.getElementById('error-status');
            try {
                log('Checking dependencies...', 'info');
                
                const dependencies = {
                    'Firebase': typeof firebase !== 'undefined',
                    'Service Worker': 'serviceWorker' in navigator,
                    'Notifications': 'Notification' in window,
                    'Clipboard': !!navigator.clipboard,
                    'Geolocation': 'geolocation' in navigator,
                    'Contacts': 'contacts' in navigator
                };
                
                const available = Object.entries(dependencies).filter(([name, available]) => available);
                const missing = Object.entries(dependencies).filter(([name, available]) => !available);
                
                if (missing.length === 0) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ All dependencies available';
                    log('All dependencies are available', 'success');
                } else {
                    statusDiv.className = 'status warning';
                    statusDiv.textContent = `‚ö†Ô∏è Missing dependencies: ${missing.map(([name]) => name).join(', ')}`;
                    log(`Missing dependencies: ${missing.map(([name]) => name).join(', ')}`, 'warning');
                }
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Dependency check failed';
                log(`Dependency check failed: ${error.message}`, 'error');
            }
        }
        
        // Test browser compatibility
        function testBrowserCompatibility() {
            const statusDiv = document.getElementById('error-status');
            try {
                log('Testing browser compatibility...', 'info');
                
                const compatibility = {
                    'ES6 Classes': typeof class Test {} === 'function',
                    'Async/Await': typeof (async () => {}) === 'function',
                    'Arrow Functions': typeof (() => {}) === 'function',
                    'Template Literals': typeof `${'test'}` === 'string',
                    'Destructuring': (() => { const {a} = {a: 1}; return a === 1; })(),
                    'Spread Operator': (() => { const arr = [...[1,2]]; return arr.length === 2; })()
                };
                
                const supported = Object.entries(compatibility).filter(([name, supported]) => supported);
                const unsupported = Object.entries(compatibility).filter(([name, supported]) => !supported);
                
                if (unsupported.length === 0) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ Browser fully compatible';
                    log('Browser is fully compatible with SMS Detector', 'success');
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = `‚ùå Browser compatibility issues: ${unsupported.map(([name]) => name).join(', ')}`;
                    log(`Browser compatibility issues: ${unsupported.map(([name]) => name).join(', ')}`, 'error');
                }
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Browser compatibility test failed';
                log(`Browser compatibility test failed: ${error.message}`, 'error');
            }
        }
        
        // Initialize tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            log('SMS Detector test page loaded', 'success');
            log('Ready to diagnose SMS Detector issues...', 'info');
            
            // Auto-run basic tests
            setTimeout(() => {
                testSMSDetectorAvailability();
                analyzeErrors();
            }, 1000);
        });
    </script>
    <script src="universal-button-handler.js"></script>
    <script src="complete-button-functions.js"></script>
</body>
</html> 