<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="chatbot.css">
  <title>Create a New Post</title>

  <link rel="stylesheet" href="all.min.css">
<style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-image: url('right.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      background-attachment: fixed;
      color: #333;
      line-height: 1.6;
      overflow-x: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: brightness(0.7);
      z-index: -1;
    }

    /* Modern Header */
    header {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      padding: 1.5rem 0;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.3;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      position: relative;
      z-index: 2;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo-title {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.1);
    }

    .main-title {
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(45deg, #fff, #e3f2fd);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Navigation */
    nav {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-brand {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1e3c72;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-brand::before {
      content: 'üõ°Ô∏è';
      font-size: 1.8rem;
    }

    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
      align-items: center;
    }

    .nav-links a {
      color: #1e3c72 !important;
      text-decoration: none;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: 25px;
      transition: all 0.3s ease;
      position: relative;
      background: rgba(255, 255, 255, 0.9) !important;
      border: 1px solid rgba(30, 60, 114, 0.2) !important;
      display: inline-block;
    }

    .nav-links a:hover {
      background: linear-gradient(135deg, #667eea, #764ba2) !important;
      color: white !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      border-color: transparent !important;
    }

    .nav-links a.active {
      background: linear-gradient(135deg, #667eea, #764ba2) !important;
      color: white !important;
      border-color: transparent !important;
    }

    /* Main Content */
    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      min-height: calc(100vh - 200px);
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .create-hero {
      text-align: center;
      margin-bottom: 3rem;
      color: white;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .create-hero h2 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(45deg, #fff, #e3f2fd);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .create-hero p {
      font-size: 1.2rem;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Create Form */
    .create-form {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(25px);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      color: white;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: white;
      font-weight: 500;
      font-size: 1.1rem;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 1rem;
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.15);
      color: white;
      font-size: 1rem;
      transition: all 0.3s ease;
      min-height: 44px;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .form-group textarea {
      min-height: 120px;
      resize: vertical;
    }

    .char-count {
      text-align: right;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
      margin-top: 0.5rem;
    }

    .submit-btn {
      padding: 1rem 2rem;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      min-height: 50px;
      min-width: 150px;
      width: 100%;
      max-width: 300px;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Preview Section */
    .preview-section {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(25px);
      border-radius: 20px;
      padding: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      color: white;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .preview-section h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: white;
    }

    .preview-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #667eea;
    }

    .preview-content {
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.9);
    }

    /* Login Message */
    .login-message {
      background: rgba(255, 193, 7, 0.1);
      border: 1px solid rgba(255, 193, 7, 0.3);
      color: #ffc107;
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .login-message a {
      color: #ffc107;
      text-decoration: underline;
      font-weight: 600;
    }

    .login-message a:hover {
      color: #ffca2c;
    }

    /* Back to Home Button */
    .back-home {
      text-align: center;
      margin-top: 2rem;
    }

    .back-home-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      text-decoration: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .back-home-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    /* Mobile Responsive Design */
    @media screen and (max-width: 768px) {
      .header-content {
        padding: 0 1rem;
      }
      
      .header-title {
        font-size: 1.8rem;
      }
      
      .header-subtitle {
        font-size: 1rem;
      }
      
      .main-content {
        padding: 1rem;
      }
      
      .create-hero h2 {
        font-size: 2rem;
      }
      
      .create-hero p {
        font-size: 1rem;
      }
      
      .create-form {
        padding: 1.5rem;
      }
      
      .preview-section {
        padding: 1.5rem;
      }
      
      .nav-links {
        gap: 1rem;
        padding: 0 1rem;
      }
      
      .nav-links a {
        padding: 0.8rem 1rem;
        font-size: 0.9rem;
      }
    }

    @media screen and (max-width: 480px) {
      .header-title {
        font-size: 1.5rem;
      }
      
      .header-subtitle {
        font-size: 0.9rem;
      }
      
      .create-hero h2 {
        font-size: 1.8rem;
      }
      
      .create-hero p {
        font-size: 0.9rem;
      }
      
      .create-form {
        padding: 1rem;
      }
      
      .preview-section {
        padding: 1rem;
      }
      
      .nav-links {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .nav-links a {
        width: 100%;
        text-align: center;
        padding: 1rem;
      }
    }

    /* User Account Dropdown Styles */
    .user-account {
      position: relative;
    }

    .user-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 0.5rem 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .user-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 15px;
      padding: 1rem;
      min-width: 250px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.2);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 1001;
    }

    .user-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .user-info {
      padding: 1rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      margin-bottom: 1rem;
    }

    .user-info h4 {
      font-weight: 700;
      color: #1e3c72;
      font-size: 1.1rem;
      margin-bottom: 0.25rem;
    }

    .user-info p {
      color: #666;
      font-size: 0.9rem;
    }

    .user-dropdown a {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      color: #1e3c72;
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s ease;
      background: transparent;
      border: none;
      width: 100%;
      text-align: left;
    }

    .user-dropdown a:hover {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
    }

    .user-dropdown a.logout {
      color: #ef4444;
    }

    .user-dropdown a.logout:hover {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    /* Touch-friendly improvements */
    @media (hover: none) and (pointer: coarse) {
      .submit-btn,
      .back-home-btn,
      .nav-links a,
      .user-btn {
        min-height: 44px;
      }
      
      .form-group input,
      .form-group textarea {
        min-height: 44px;
        padding: 1rem;
      }
    }

    /* Notification Styles */
    .notification-item {
      position: relative;
    }

    .notification-btn {
      background: linear-gradient(135deg, #ff6b6b, #ee5a52);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 0.5rem 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
      position: relative;
    }

    .notification-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
    }

    .notification-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 15px;
      padding: 1rem;
      min-width: 300px;
      max-height: 400px;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.2);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 1001;
    }

    .notification-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .notification-header h4 {
      margin: 0;
      color: #1e3c72;
      font-weight: 700;
    }

    .notification-header button {
      background: none;
      border: none;
      color: #667eea;
      cursor: pointer;
      font-size: 0.8rem;
      text-decoration: underline;
    }

    .notification-list {
      /* Styles for individual notifications */
    }

    .notification-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .notification-item:hover {
      background-color: rgba(102, 126, 234, 0.05);
    }

    .notification-item .icon {
      font-size: 1.2rem;
      color: #667eea;
    }

    .notification-item .title {
      font-weight: 600;
      color: #333;
      font-size: 0.9rem;
    }

    .notification-item .message {
      font-size: 0.8rem;
      color: #666;
      margin-top: 0.25rem;
    }

    .notification-item .timestamp {
      font-size: 0.7rem;
      color: #999;
      margin-left: 0.5rem;
    }

    .notification-item.unread {
      background-color: rgba(102, 126, 234, 0.08);
      font-weight: 600;
    }

    .no-notifications {
      text-align: center;
      color: #666;
      padding: 2rem;
      font-style: italic;
    }
  </style>
</head>
<body>
    <!-- Header -->
  <header>
          <div class="header-content">
        <div class="logo-title">
          <img src="logo.png" alt="SMS Phishing Logo" class="logo">
          <h1 class="main-title">SMS Phishing Detection</h1>
        </div>
      </div>
  </header>

  <!-- Navigation -->
  <nav>
    <div class="nav-container">
      <a href="#" class="nav-brand">SMS Phishing Detection</a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="detect.html">Detection</a></li>
        <li><a href="sms.html">SMS Alerts</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li class="notification-item" id="notificationItem" style="display: none;">
          <button class="notification-btn" onclick="toggleNotificationDropdown()" style="
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            position: relative;
          ">
            <i class="fas fa-bell"></i>
            <span id="notificationCount" style="
              position: absolute;
              top: -5px;
              right: -5px;
              background: #ff4757;
              color: white;
              border-radius: 50%;
              width: 20px;
              height: 20px;
              font-size: 0.7rem;
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: bold;
            ">0</span>
          </button>
          <div class="notification-dropdown" id="notificationDropdown" style="
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 1rem;
            min-width: 300px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1001;
          ">
            <div class="notification-header" style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 1rem;
              padding-bottom: 0.5rem;
              border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            ">
              <h4 style="margin: 0; color: #1e3c72; font-weight: 700;">Notifications</h4>
              <button onclick="markAllAsRead()" style="
                background: none;
                border: none;
                color: #667eea;
                cursor: pointer;
                font-size: 0.8rem;
                text-decoration: underline;
              ">Mark all read</button>
            </div>
            <div class="notification-list" id="notificationList">
              <!-- Notifications will be populated here -->
            </div>
            <div class="no-notifications" id="noNotifications" style="
              text-align: center;
              color: #666;
              padding: 2rem;
              font-style: italic;
            ">
              No notifications yet
            </div>
          </div>
        </li>
        <li class="user-account" id="userAccount" style="display: none;">
          <button class="user-btn" onclick="toggleUserDropdown()">
            <i class="fas fa-user"></i>
            <span id="userDisplayName">User</span>
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="user-dropdown" id="userDropdown">
            <div class="user-info">
              <h4 id="dropdownUsername">Username</h4>
              <p id="dropdownEmail">email@example.com</p>
            </div>
            <a href="dashboard.html"><i class="fas fa-chart-line"></i> Dashboard</a>
            <a href="profile.html"><i class="fas fa-user"></i> Profile</a>
            <a href="create.html"><i class="fas fa-plus"></i> Create Post</a>
            <a href="#" onclick="logout()" class="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
          </div>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <div class="create-hero">
    <h2>Create a New Post</h2>
      <p>Share your thoughts, experiences, or insights with the community. Your posts help others stay informed about SMS phishing threats.</p>
    </div>

    <div class="create-form">
      <form id="createForm">
        <div class="form-group">
          <label for="title">Post Title</label>
          <input type="text" id="title" name="title" placeholder="Enter your post title..." required>
        </div>
      </form>
    </div>

    <div class="create-form">
      <form id="contentForm">
        <div class="form-group">
          <label for="content">Post Content</label>
          <textarea id="content" name="content" placeholder="Share your thoughts, experiences, or insights here..." required></textarea>
          <div class="char-count" id="contentCount">Characters: 0</div>
        </div>
        
        <button type="submit" class="submit-btn">
          <i class="fas fa-paper-plane"></i> Create Post
        </button>
      </form>
    </div>

    <div class="preview-section">
      <h3><i class="fas fa-eye"></i> Post Preview</h3>
      <div class="preview-title" id="previewTitle"></div>
      <div class="preview-content" id="previewContent"></div>
      

    </div>

    <div class="back-home">
      <a href="index.html" class="back-home-btn">
        <i class="fas fa-home"></i> Back to Home
      </a>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="firebase.js"></script>
  <script src="darkMode.js"></script>
  <script src="chatbot.js"></script>
  
  <script>
    // Character count and preview
    const titleInput = document.getElementById('title');
    const contentInput = document.getElementById('content');
    const contentCount = document.getElementById('contentCount');
    const previewTitle = document.getElementById('previewTitle');
    const previewContent = document.getElementById('previewContent');
    
    if (contentInput) {
      contentInput.addEventListener('input', () => {
        contentCount.textContent = 'Characters: ' + contentInput.value.length;
        if (previewContent) {
          previewContent.textContent = contentInput.value;
        }
      });
    }
    
    if (titleInput) {
      titleInput.addEventListener('input', () => {
        if (previewTitle) {
          previewTitle.textContent = titleInput.value;
        }
      });
    }
    
    // Post submission
    document.getElementById('contentForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const title = titleInput.value;
      const content = contentInput.value;
      
      if (!title.trim() || !content.trim()) {
        alert('Please fill in both title and content.');
        return;
      }
      
      // Check if user is authenticated
      const user = auth.currentUser;
      if (!user) {
        alert('Please log in to create a post.');
        window.location.href = 'login.html';
        return;
      }
      
      try {
        // Show loading state
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Post...';
        submitBtn.disabled = true;
        
        // Create post with user information
        const postData = {
          title: title.trim(),
          content: content.trim(),
          author: user.email ? user.email.split('@')[0] : 'Anonymous',
          authorId: user.uid,
          timestamp: firebase.database.ServerValue.TIMESTAMP,
          likes: 0,
          comments: {}
        };
        
        // Write to database
        const newPostRef = await db.ref('posts').push(postData);
        
        // Success
        alert('Post created successfully!');
        titleInput.value = '';
        contentInput.value = '';
        if (previewTitle) previewTitle.textContent = '';
        if (previewContent) previewContent.textContent = '';
        contentCount.textContent = 'Characters: 0';
        
        // Redirect to the new post
        setTimeout(() => {
          window.location.href = `post.html?id=${newPostRef.key}`;
        }, 1000);
        
      } catch (err) {
        console.error('Post creation error:', err);
        
        // Handle specific Firebase errors
        if (err.code === 'PERMISSION_DENIED') {
          alert('Permission denied. Please make sure you are logged in and try again.');
          // Redirect to login if not authenticated
          if (!auth.currentUser) {
            window.location.href = 'login.html';
          }
        } else if (err.code === 'UNAUTHORIZED') {
          alert('You need to be logged in to create posts. Redirecting to login...');
          window.location.href = 'login.html';
        } else {
          alert('Error creating post: ' + err.message);
        }
      } finally {
        // Reset button state
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Create Post';
        submitBtn.disabled = false;
      }
    });
    
    // Check authentication status on page load
    auth.onAuthStateChanged((user) => {
      if (!user) {
        // User is not logged in, show message
        const createForm = document.getElementById('contentForm');
        if (createForm) {
          const loginMessage = document.createElement('div');
          loginMessage.className = 'login-message';
          loginMessage.innerHTML = `
            <strong>‚ö†Ô∏è Login Required</strong><br>
            You need to be logged in to create posts. 
            <a href="login.html">Click here to login</a>
          `;
          createForm.insertBefore(loginMessage, createForm.firstChild);
        }
      }
    });

    // User account dropdown functionality
    function toggleUserDropdown() {
      const dropdown = document.getElementById('userDropdown');
      dropdown.classList.toggle('show');
    }

    function logout() {
      auth.signOut().then(() => {
        window.location.href = 'index.html';
      }).catch((error) => {
        console.error('Logout error:', error);
      });
    }

    // Update user display when auth state changes
    auth.onAuthStateChanged((user) => {
      const userAccount = document.getElementById('userAccount');
      const userDisplayName = document.getElementById('userDisplayName');
      const dropdownUsername = document.getElementById('dropdownUsername');
      const dropdownEmail = document.getElementById('dropdownEmail');
      const notificationItem = document.getElementById('notificationItem');

      if (user) {
        userAccount.style.display = 'flex';
        notificationItem.style.display = 'flex'; // Show notification button for logged in users
        const displayName = user.email ? user.email.split('@')[0] : 'User';
        userDisplayName.textContent = displayName;
        dropdownUsername.textContent = displayName;
        dropdownEmail.textContent = user.email || 'No email';
        
        // Fetch notifications for logged in user
        fetchNotifications();
      } else {
        userAccount.style.display = 'none';
        notificationItem.style.display = 'none'; // Hide notification button for logged out users
      }
    });

    // Close dropdown when clicking outside
    window.onclick = function(event) {
      if (!event.target.matches('.user-btn')) {
        const dropdowns = document.getElementsByClassName('user-dropdown');
        for (let dropdown of dropdowns) {
          if (dropdown.classList.contains('show')) {
            dropdown.classList.remove('show');
          }
        }
      }
    }

    // Notification dropdown functionality
    function toggleNotificationDropdown() {
      const dropdown = document.getElementById('notificationDropdown');
      dropdown.classList.toggle('show');
    }

    function markAllAsRead() {
      const notificationList = document.getElementById('notificationList');
      const notifications = notificationList.querySelectorAll('.notification-item');
      notifications.forEach(item => {
        item.classList.remove('unread');
      });
      updateNotificationCount(0);
      alert('All notifications marked as read!');
    }

    function updateNotificationCount(count) {
      const notificationCountSpan = document.getElementById('notificationCount');
      if (notificationCountSpan) {
        notificationCountSpan.textContent = count;
        notificationCountSpan.style.display = count > 0 ? 'flex' : 'none';
      }
    }

    function addNotification(type, title, message, timestamp) {
      const notificationList = document.getElementById('notificationList');
      const notificationItem = document.createElement('div');
      notificationItem.className = 'notification-item';
      notificationItem.innerHTML = `
        <i class="fas fa-${type} icon"></i>
        <div class="title">${title}</div>
        <div class="message">${message}</div>
        <div class="timestamp">${timestamp}</div>
      `;
      notificationList.insertBefore(notificationItem, notificationList.firstChild);
      updateNotificationCount(parseInt(document.getElementById('notificationCount').textContent) + 1);
      notificationItem.classList.add('unread');
    }

    function fetchNotifications() {
      const user = auth.currentUser;
      if (!user) {
        updateNotificationCount(0);
        return;
      }

      const notificationsRef = db.ref(`notifications/${user.uid}`);
      notificationsRef.on('value', (snapshot) => {
        const notifications = snapshot.val();
        const notificationList = document.getElementById('notificationList');
        notificationList.innerHTML = ''; // Clear existing notifications
        let unreadCount = 0;

        if (notifications) {
          for (const key in notifications) {
            const notification = notifications[key];
            const notificationItem = document.createElement('div');
            notificationItem.className = 'notification-item';
            notificationItem.innerHTML = `
              <i class="fas fa-${notification.type} icon"></i>
              <div class="title">${notification.title}</div>
              <div class="message">${notification.message}</div>
              <div class="timestamp">${notification.timestamp}</div>
            `;
            notificationList.appendChild(notificationItem);
            if (!notification.read) {
              unreadCount++;
              notificationItem.classList.add('unread');
            }
          }
        } else {
          notificationList.innerHTML = '<div class="no-notifications">No notifications yet</div>';
        }
        updateNotificationCount(unreadCount);
      });
    }

    // Initial fetch on page load
    fetchNotifications();



    // Notification System Functions
    function toggleNotificationDropdown() {
      const dropdown = document.getElementById('notificationDropdown');
      dropdown.classList.toggle('show');
    }

    function markAllAsRead() {
      const user = auth.currentUser;
      if (!user) return;

      const notificationsRef = db.ref(`notifications/${user.uid}`);
      notificationsRef.once('value').then((snapshot) => {
        const updates = {};
        snapshot.forEach((childSnapshot) => {
          updates[`${childSnapshot.key}/read`] = true;
        });
        return notificationsRef.update(updates);
      }).then(() => {
        updateNotificationCount(0);
        alert('All notifications marked as read!');
      });
    }

    function updateNotificationCount(count) {
      const notificationCountSpan = document.getElementById('notificationCount');
      if (notificationCountSpan) {
        notificationCountSpan.textContent = count;
        notificationCountSpan.style.display = count > 0 ? 'flex' : 'none';
      }
    }

    function addNotification(type, title, message) {
      const user = auth.currentUser;
      if (!user) return;

      const notification = {
        type: type,
        title: title,
        message: message,
        timestamp: new Date().toLocaleString(),
        read: false
      };

      const notificationsRef = db.ref(`notifications/${user.uid}`);
      notificationsRef.push(notification);
    }

    function fetchNotifications() {
      const user = auth.currentUser;
      if (!user) {
        updateNotificationCount(0);
        return;
      }

      const notificationsRef = db.ref(`notifications/${user.uid}`);
      notificationsRef.on('value', (snapshot) => {
        const notifications = snapshot.val();
        const notificationList = document.getElementById('notificationList');
        const noNotifications = document.getElementById('noNotifications');
        
        notificationList.innerHTML = '';
        let unreadCount = 0;

        if (notifications) {
          const notificationArray = [];
          for (const key in notifications) {
            notificationArray.push({ key, ...notifications[key] });
          }
          
          // Sort by timestamp (newest first)
          notificationArray.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
          
          notificationArray.forEach(notification => {
            const notificationItem = document.createElement('div');
            notificationItem.className = 'notification-item';
            if (!notification.read) {
              notificationItem.classList.add('unread');
              unreadCount++;
            }
            
            notificationItem.innerHTML = `
              <i class="fas fa-${notification.type} icon"></i>
              <div style="flex: 1;">
                <div class="title">${notification.title}</div>
                <div class="message">${notification.message}</div>
              </div>
              <div class="timestamp">${notification.timestamp}</div>
            `;
            
            notificationItem.addEventListener('click', () => {
              markNotificationAsRead(notification.key);
            });
            
            notificationList.appendChild(notificationItem);
          });
          
          noNotifications.style.display = notificationArray.length === 0 ? 'block' : 'none';
        } else {
          noNotifications.style.display = 'block';
        }
        
        updateNotificationCount(unreadCount);
      });
    }

    function markNotificationAsRead(notificationKey) {
      const user = auth.currentUser;
      if (!user) return;

      const notificationRef = db.ref(`notifications/${user.uid}/${notificationKey}`);
      notificationRef.update({ read: true });
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
      const notificationDropdown = document.getElementById('notificationDropdown');
      const userDropdown = document.getElementById('userDropdown');
      
      if (!e.target.closest('.notification-item') && notificationDropdown) {
        notificationDropdown.classList.remove('show');
      }
      
      if (!e.target.closest('.user-account') && userDropdown) {
        userDropdown.classList.remove('show');
      }
    });

    // Add hover effects for dropdown links
    document.addEventListener('DOMContentLoaded', function() {
      const dropdownLinks = document.querySelectorAll('.user-dropdown a');
      dropdownLinks.forEach(link => {
        link.addEventListener('mouseenter', function() {
          this.style.transform = 'translateX(5px)';
        });
        
        link.addEventListener('mouseleave', function() {
          this.style.transform = 'translateX(0)';
        });
      });
      
      // Add hover effects for SMS buttons
      const smsButtons = document.querySelectorAll('.sms-btn');
      smsButtons.forEach(btn => {
        btn.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-2px)';
        });
        
        btn.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
        });
      });

      // Add hover effects for notification button
      const notificationBtn = document.querySelector('.notification-btn');
      if (notificationBtn) {
        notificationBtn.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-2px)';
        });
        
        notificationBtn.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
        });
      }

      // Add test notification button (for testing purposes)
      const testNotificationBtn = document.createElement('button');
      testNotificationBtn.textContent = 'Test Notification';
      testNotificationBtn.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 25px;
        padding: 0.8rem 1.5rem;
        font-weight: 600;
        cursor: pointer;
        z-index: 1000;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      `;
      testNotificationBtn.onclick = () => {
        const notificationTypes = ['shield-alt', 'exclamation-triangle', 'check-circle', 'info-circle', 'bell'];
        const titles = ['Security Alert', 'Phishing Detected', 'Analysis Complete', 'System Update', 'New Feature'];
        const messages = [
          'A suspicious SMS was detected in your recent analysis.',
          'High-risk phishing attempt identified in your inbox.',
          'Your SMS analysis has been completed successfully.',
          'New security features have been added to your account.',
          'You can now share alerts directly via SMS!'
        ];
        
        const randomIndex = Math.floor(Math.random() * notificationTypes.length);
        addNotification(
          notificationTypes[randomIndex],
          titles[randomIndex],
          messages[randomIndex]
        );
        
        alert('Test notification added! Check the notification bell.');
      };
      document.body.appendChild(testNotificationBtn);
    });
  </script>
</body>
</html>
