<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mobile SMS Dashboard - SMS Shield</title>
  <link rel="stylesheet" href="enhanced-design.css">
  <link rel="stylesheet" href="mobile-enhancements.css">
  <link rel="stylesheet" href="cross-platform-responsive.css">
  <link rel="stylesheet" href="all.min.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    .sms-analysis-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    
    .modal-content {
      background: var(--card-bg);
      border-radius: 1rem;
      padding: 2rem;
      max-width: 90%;
      max-height: 80%;
      overflow-y: auto;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .modal-header button {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
    }
    
    .permission-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    
    .dialog-content {
      background: var(--card-bg);
      border-radius: 1rem;
      padding: 2rem;
      max-width: 90%;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .dialog-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1.5rem;
    }
    
    .sms-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1rem;
      border-left: 4px solid;
      transition: all 0.3s ease;
    }
    
    .sms-item.phishing {
      border-left-color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
    }
    
    .sms-item.safe {
      border-left-color: #10b981;
      background: rgba(16, 185, 129, 0.1);
    }
    
    .sms-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .sms-sender {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .sms-time {
      font-size: 0.9rem;
      opacity: 0.7;
    }
    
    .sms-message {
      margin-bottom: 1rem;
      line-height: 1.5;
    }
    
    .sms-analysis {
      padding: 1rem;
      border-radius: 0.5rem;
      margin-top: 1rem;
    }
    
    .sms-analysis.phishing {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    .sms-analysis.safe {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 0.5rem;
    }
    
    .status-indicator.active {
      background: #10b981;
      animation: pulse 2s infinite;
    }
    
    .status-indicator.inactive {
      background: #6b7280;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 1rem;
      padding: 1.5rem;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    
    .stat-label {
      font-size: 0.9rem;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <!-- Enhanced Theme Toggle -->
  <button class="nav-link theme-toggle-nav" onclick="toggleTheme()" aria-label="Toggle theme">
    üåô
  </button>
  
  <!-- Cache Clear Button -->
  <button class="cache-clear-btn" onclick="clearCacheAndReload()" aria-label="Clear cache" style="position: fixed; top: 20px; right: 80px; z-index: 1000; background: rgba(239, 68, 68, 0.9); color: white; border: none; padding: 10px; border-radius: 50%; cursor: pointer; font-size: 16px; backdrop-filter: blur(10px);">
    üîÑ
  </button>

  <!-- Enhanced Header -->
  <header class="enhanced-header">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo-icon">üõ°Ô∏è</div>
        <a href="index.html" class="logo-text">SMS Shield</a>
      </div>
      
      <nav class="enhanced-nav">
        <a href="index.html" class="nav-link">Home</a>
        <a href="detect.html" class="nav-link">Detect</a>
        <a href="dashboard.html" class="nav-link">Dashboard</a>
        <a href="profile.html" class="nav-link">Profile</a>
        <a href="about.html" class="nav-link">About</a>
        <a href="contact.html" class="nav-link">Contact</a>
        <a href="login.html" class="nav-link auth-link">Sign In</a>
        <button class="nav-link theme-toggle-nav" onclick="toggleTheme()" aria-label="Toggle theme">
          üåô
        </button>
      </nav>

      <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu">
        ‚ò∞
      </button>
    </div>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mobile-menu">
      <div class="mobile-menu-links">
        <a href="index.html" class="nav-link">üè† Home</a>
        <a href="detect.html" class="nav-link">üîç Detect SMS</a>
        <a href="dashboard.html" class="nav-link">üìä Dashboard</a>
        <a href="profile.html" class="nav-link">üë§ Profile</a>
        <a href="about.html" class="nav-link">‚ÑπÔ∏è About</a>
        <a href="contact.html" class="nav-link">üìû Contact</a>
        <a href="login.html" class="nav-link">üîê Sign In</a>
        <button class="nav-link theme-toggle-nav" onclick="toggleTheme()" aria-label="Toggle theme">
          üåô
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile SMS Dashboard Hero -->
  <section class="enhanced-hero animate-slide-up" style="padding-top: 120px;">
    <h1 class="hero-title">üì± Mobile SMS Dashboard</h1>
    <p class="hero-subtitle">
      Real-time SMS monitoring and analysis for your mobile device
    </p>
  </section>

  <!-- SMS Integration Status -->
  <section style="padding: 2rem 1.5rem; max-width: 1200px; margin: 0 auto;">
    <div class="card-enhanced animate-slide-up" style="padding: 2rem; margin-bottom: 2rem;">
      <h2 style="text-align: center; margin-bottom: 2rem; color: #06b6d4;">üì± SMS Integration Status</h2>
      
      <div id="integrationStatus" style="text-align: center; margin-bottom: 2rem;">
        <div style="margin-bottom: 1rem;">
          <span class="status-indicator" id="monitoringStatus"></span>
          <span id="statusText">Checking SMS integration...</span>
        </div>
        
        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
          <button id="startMonitoring" class="btn-enhanced btn-primary" onclick="startSMSMonitoring()">
            <i class="fas fa-play"></i>
            Start Monitoring
          </button>
          <button id="stopMonitoring" class="btn-enhanced btn-secondary" onclick="stopSMSMonitoring()" style="display: none;">
            <i class="fas fa-stop"></i>
            Stop Monitoring
          </button>
          <button class="btn-enhanced btn-secondary" onclick="testSMSIntegration()">
            <i class="fas fa-vial"></i>
            Test SMS
          </button>
        </div>
      </div>
      
      <div id="permissionStatus" style="text-align: center;">
        <h3 style="margin-bottom: 1rem;">Permissions</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
          <div style="padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 0.5rem;">
            <div style="font-weight: 600; margin-bottom: 0.5rem;">SMS Access</div>
            <div id="smsPermission" style="opacity: 0.8;">Checking...</div>
          </div>
          <div style="padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 0.5rem;">
            <div style="font-weight: 600; margin-bottom: 0.5rem;">Notifications</div>
            <div id="notificationPermission" style="opacity: 0.8;">Checking...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- SMS Statistics -->
    <div class="card-enhanced animate-slide-up" style="padding: 2rem; margin-bottom: 2rem;">
      <h2 style="text-align: center; margin-bottom: 2rem; color: #10b981;">üìä SMS Analysis Statistics</h2>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="totalSMS">0</div>
          <div class="stat-label">Total SMS</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="phishingSMS">0</div>
          <div class="stat-label">Phishing Detected</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="safeSMS">0</div>
          <div class="stat-label">Safe Messages</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="avgConfidence">0%</div>
          <div class="stat-label">Avg Confidence</div>
        </div>
      </div>
      
      <div style="text-align: center;">
        <button class="btn-enhanced btn-secondary" onclick="clearSMSHistory()">
          <i class="fas fa-trash"></i>
          Clear History
        </button>
      </div>
    </div>

    <!-- Recent SMS Analysis -->
    <div class="card-enhanced animate-slide-up" style="padding: 2rem;">
      <h2 style="text-align: center; margin-bottom: 2rem; color: #f59e0b;">üì± Recent SMS Analysis</h2>
      
      <div id="smsList" style="max-height: 500px; overflow-y: auto;">
        <div style="text-align: center; padding: 2rem; opacity: 0.7;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">üì±</div>
          <p>No SMS messages analyzed yet.</p>
          <p>Start monitoring to see real-time analysis.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Enhanced Footer -->
  <footer class="enhanced-footer">
    <div style="max-width: 1200px; margin: 0 auto;">
      <div style="text-align: center; padding-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.1); opacity: 0.8;">
        <p>&copy; 2024 SMS Shield. Real-time mobile protection.</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="cache-clear.js"></script>
  <script src="navigation-fix.js"></script>
  <script src="enhanced-design-system.js"></script>
  <script src="darkMode.js"></script>
  <script src="mobile-sms-integration.js"></script>
  <script>
    let smsIntegration = null;
    let smsHistory = [];
    
    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('üì± Mobile SMS Dashboard initializing...');
      
      // Wait for SMS integration to load
      await waitForSMSIntegration();
      
      // Initialize dashboard
      initializeDashboard();
      
      // Listen for service worker messages
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.addEventListener('message', handleServiceWorkerMessage);
      }
    });
    
    // Wait for SMS integration to be available
    async function waitForSMSIntegration() {
      return new Promise((resolve) => {
        const checkIntegration = () => {
          if (window.smsIntegration) {
            smsIntegration = window.smsIntegration;
            resolve();
          } else {
            setTimeout(checkIntegration, 100);
          }
        };
        checkIntegration();
      });
    }
    
    // Initialize dashboard
    function initializeDashboard() {
      updateIntegrationStatus();
      updatePermissions();
      loadSMSHistory();
      updateStatistics();
    }
    
    // Update integration status
    function updateIntegrationStatus() {
      if (!smsIntegration) return;
      
      const status = smsIntegration.getStatus();
      const statusIndicator = document.getElementById('monitoringStatus');
      const statusText = document.getElementById('statusText');
      const startBtn = document.getElementById('startMonitoring');
      const stopBtn = document.getElementById('stopMonitoring');
      
      if (status.monitoring) {
        statusIndicator.className = 'status-indicator active';
        statusText.textContent = 'SMS monitoring active';
        startBtn.style.display = 'none';
        stopBtn.style.display = 'inline-flex';
      } else {
        statusIndicator.className = 'status-indicator inactive';
        statusText.textContent = 'SMS monitoring inactive';
        startBtn.style.display = 'inline-flex';
        stopBtn.style.display = 'none';
      }
    }
    
    // Update permissions
    function updatePermissions() {
      if (!smsIntegration) return;
      
      const status = smsIntegration.getStatus();
      const smsPermission = document.getElementById('smsPermission');
      const notificationPermission = document.getElementById('notificationPermission');
      
      smsPermission.textContent = status.permissions.sms ? '‚úÖ Granted' : '‚ùå Denied';
      notificationPermission.textContent = status.permissions.notifications ? '‚úÖ Granted' : '‚ùå Denied';
    }
    
    // Load SMS history
    function loadSMSHistory() {
      if (!smsIntegration) return;
      
      smsHistory = smsIntegration.getAnalysisHistory();
      displaySMSHistory();
    }
    
    // Display SMS history
    function displaySMSHistory() {
      const smsList = document.getElementById('smsList');
      
      if (smsHistory.length === 0) {
        smsList.innerHTML = `
          <div style="text-align: center; padding: 2rem; opacity: 0.7;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üì±</div>
            <p>No SMS messages analyzed yet.</p>
            <p>Start monitoring to see real-time analysis.</p>
          </div>
        `;
        return;
      }
      
      // Sort by timestamp (newest first)
      const sortedHistory = smsHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      smsList.innerHTML = sortedHistory.map(sms => `
        <div class="sms-item ${sms.analysis.isPhishing ? 'phishing' : 'safe'}">
          <div class="sms-header">
            <div class="sms-sender">${sms.sender || 'Unknown'}</div>
            <div class="sms-time">${formatTime(sms.timestamp)}</div>
          </div>
          <div class="sms-message">${sms.message}</div>
          <div class="sms-analysis ${sms.analysis.isPhishing ? 'phishing' : 'safe'}">
            <div style="font-weight: 600; margin-bottom: 0.5rem;">
              ${sms.analysis.isPhishing ? 'üö® Phishing Detected' : '‚úÖ Safe Message'}
            </div>
            <div style="margin-bottom: 0.5rem;">
              <strong>Confidence:</strong> ${sms.analysis.confidence}%
            </div>
            <div style="margin-bottom: 0.5rem;">
              <strong>Reason:</strong> ${sms.analysis.reason}
            </div>
            <div>
              <strong>Recommendations:</strong>
              <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                ${sms.analysis.recommendations.map(rec => `<li>${rec}</li>`).join('')}
              </ul>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    // Update statistics
    function updateStatistics() {
      const totalSMS = smsHistory.length;
      const phishingSMS = smsHistory.filter(sms => sm.analysis.isPhishing).length;
      const safeSMS = totalSMS - phishingSMS;
      const avgConfidence = totalSMS > 0 
        ? Math.round(smsHistory.reduce((sum, sms) => sum + sms.analysis.confidence, 0) / totalSMS)
        : 0;
      
      document.getElementById('totalSMS').textContent = totalSMS;
      document.getElementById('phishingSMS').textContent = phishingSMS;
      document.getElementById('safeSMS').textContent = safeSMS;
      document.getElementById('avgConfidence').textContent = `${avgConfidence}%`;
    }
    
    // Start SMS monitoring
    async function startSMSMonitoring() {
      if (!smsIntegration) return;
      
      try {
        const success = await smsIntegration.init();
        if (success) {
          updateIntegrationStatus();
          showSuccess('SMS monitoring started successfully!', 'üì± SMS Shield');
        } else {
          showError('Failed to start SMS monitoring. Check permissions.', '‚ùå SMS Shield');
        }
      } catch (error) {
        console.error('Failed to start monitoring:', error);
        showError('Failed to start SMS monitoring.', '‚ùå SMS Shield');
      }
    }
    
    // Stop SMS monitoring
    function stopSMSMonitoring() {
      if (!smsIntegration) return;
      
      // Note: In a real implementation, you would stop the monitoring
      // For now, we'll just update the UI
      updateIntegrationStatus();
      showInfo('SMS monitoring stopped.', 'üì± SMS Shield');
    }
    
    // Test SMS integration
    async function testSMSIntegration() {
      if (!smsIntegration) return;
      
      const testMessage = "URGENT: Your bank account has been suspended. Click here to verify: http://fake-bank.com";
      
      try {
        await smsIntegration.handleIncomingSMS(testMessage);
        showSuccess('Test SMS processed successfully!', 'üß™ SMS Shield');
        
        // Refresh display
        setTimeout(() => {
          loadSMSHistory();
          updateStatistics();
        }, 1000);
        
      } catch (error) {
        console.error('Test SMS failed:', error);
        showError('Test SMS failed.', '‚ùå SMS Shield');
      }
    }
    
    // Clear SMS history
    function clearSMSHistory() {
      if (!smsIntegration) return;
      
      if (confirm('Are you sure you want to clear all SMS analysis history?')) {
        smsIntegration.clearAnalysisHistory();
        smsHistory = [];
        displaySMSHistory();
        updateStatistics();
        showSuccess('SMS history cleared successfully!', 'üóëÔ∏è SMS Shield');
      }
    }
    
    // Handle service worker messages
    function handleServiceWorkerMessage(event) {
      const { type, data } = event.data;
      
      switch (type) {
        case 'new-sms':
          console.log('New SMS received:', data);
          // Add to history and update display
          smsHistory.unshift({
            ...data.sms,
            analysis: data.analysis
          });
          displaySMSHistory();
          updateStatistics();
          break;
          
        case 'spam-reported':
          console.log('SMS reported as spam:', data);
          showSuccess('SMS reported as spam successfully!', 'üö´ SMS Shield');
          break;
          
        case 'sender-blocked':
          console.log('Sender blocked:', data);
          showSuccess('Sender blocked successfully!', 'üö´ SMS Shield');
          break;
      }
    }
    
    // Format time
    function formatTime(timestamp) {
      const date = new Date(timestamp);
      return date.toLocaleString();
    }
    
    // Enhanced theme toggle
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      const themeToggle = document.querySelector('.theme-toggle-nav');
      const isDark = document.body.classList.contains('dark-mode');
      themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('darkMode', isDark);
    }

    // Mobile menu toggle
    function toggleMobileMenu() {
      const mobileMenu = document.getElementById('mobileMenu');
      const menuBtn = document.querySelector('.mobile-menu-btn');

      if (mobileMenu.classList.contains('show')) {
        mobileMenu.classList.remove('show');
        menuBtn.textContent = '‚ò∞';
        document.body.style.overflow = '';
      } else {
        mobileMenu.classList.add('show');
        menuBtn.textContent = '‚úï';
        document.body.style.overflow = 'hidden';
      }
    }

    // Load saved theme
    window.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('darkMode');
      if (savedTheme === 'true') {
        document.body.classList.add('dark-mode');
        document.querySelector('.theme-toggle-nav').textContent = '‚òÄÔ∏è';
      }
    });
  </script>
  
  <!-- Cross-Platform Script -->
  <script src="cross-platform-responsive.js"></script>
</body>
</html>
